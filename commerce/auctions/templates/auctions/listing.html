{% extends "auctions/layout.html" %}

{% block body %}
    <div class="listing_row">
        <div class="listing_split listing_border">
            <!-- Listing info section -->
            <div class="listing_image_box">
                <!-- If no photo available, pass to avoid error -->
                {% if listing.image %}
                    <img src="{{ listing.image.url }}" alt="No Image" class="listing_image_resized">
                {% else %}
                    <p>No photo available</p>
                {% endif %}    
            </div>
        </div>
        
        <div class="listing_split listing_border">
            <h5>{{ listing }}</h5>
            <div class="other_listing_info_container">
                <ul>  
                    <li>Creator: {{ listing.user.username }}</li>
                    <li>Category: {{ listing.category }}</li>
                    <li><b>Current Bid ($): {{ listing.price }}</b></li>
                    <li>Description: {{ listing.description }}</li>
                    
                </ul>
            </div>
    
            <!-- <div class="listing_message">
                pass
            </div> -->
        </div>
        
        <div class="listing_split listing_border">
            <div class="listing_message">
                Auction status: <b>{{ listing.status }}</b>
                {% if listing.status == "Closed" or message == "Auction is closed" %}   
                <ul>  
                    {% if message == "Auction is NOW closed" %}
                        <li> Adjusted status: <b>{{ message }}</b> </li>
                    {% elif listing.status == "Closed" %}
                        <li> Auction status: <b>{{ listing.status }}</b> </li>
                    {% endif %}

                    {% if bid.user %}
                        <li> Winner: {{ bid.user }} </li>
                    {% else %}
                        <li> Winner: None </li>
                    {% endif %}
                    
                </ul>
                <!-- {% elif message == "Only creator can close this auction!" %} -->
                {% else %}
                    <h5>{{ message }}</h5>
                {% endif %} 
            </div>

            <div class="listing_buttons">
                <form method="post" action="{% url 'listing' listing.id %}">
                    {% csrf_token %}
                    <button type="submit" name="close_auction">Close Auction</button>
                </form>
        
                <form method="post" action="{% url 'watchlist' %}">
                    {% csrf_token %}
                    <!-- <input type="hidden" name="page_url" value="{{ request.build_absolute_uri }}"> -->
                    <input type="hidden" name="listing_id" value="{{ listing.id }}">
                    <button type="submit" name="add_button">Add to watchlist</button>
                </form>
        
                <form method="post" action="{% url 'bid' %}">
                    {% csrf_token %}
                    <label for="bid">Your Bid:</label><br>   
                    <input type="number" id="bid_price" name="bid_price" placeholder="input your bid">
                    <input type="hidden" name="listing_id" value="{{ listing.id }}">
                    <button type="submit" name="bid_price_submit">Bid now</button>
                </form> 
            </div> 

            <!-- <h5>Products in same category</h5>
            {% for product in products %}
            <ul>
                <li><a href="{% url 'listing' product.id %}"> {{ product }} </a></li>
            </ul>
            {% endfor %} -->
        </div>
    </div>

    <!-- Comment section -->
    <div class="all_comment">
        <h4>Comments:</h4>
        <div class="input_comment">
            <form method="post" action="{% url 'listing' listing.id %}">
                {% csrf_token %}
                <textarea name="comment" rows="3" cols="100" placeholder="Share your thought..."></textarea>
                <input type="submit" name="submit_comment">
            </form>
        </div>
        <div>
            {% if all_comments %}
                {% for comment in all_comments %}
                <ul>
                    <li>{{ comment.user }}: {{ comment.content }}</li>
                </ul>
                {% endfor %}
            {% else %}
                <div>What do you think about this product? ^.^</div>
            {% endif %}
        </div>
    </div>
    
    
{% endblock %}